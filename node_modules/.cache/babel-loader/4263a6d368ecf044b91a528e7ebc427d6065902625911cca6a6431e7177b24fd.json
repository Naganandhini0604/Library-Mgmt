{"ast":null,"code":"'use strict';\n\n/*!\n * ignore\n */\nmodule.exports = applyQueryMiddleware;\n\n/*!\n * ignore\n */\n\napplyQueryMiddleware.middlewareFunctions = ['count', 'countDocuments', 'deleteMany', 'deleteOne', 'distinct', 'estimatedDocumentCount', 'find', 'findOne', 'findOneAndDelete', 'findOneAndRemove', 'findOneAndReplace', 'findOneAndUpdate', 'remove', 'replaceOne', 'update', 'updateMany', 'updateOne', 'validate'];\n\n/*!\n * Apply query middleware\n *\n * @param {Query} query constructor\n * @param {Model} model\n */\n\nfunction applyQueryMiddleware(Query, model) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1,\n    nullResultByDefault: true\n  };\n  const middleware = model.hooks.filter(hook => {\n    const contexts = _getContexts(hook);\n    if (hook.name === 'updateOne') {\n      return contexts.query == null || !!contexts.query;\n    }\n    if (hook.name === 'deleteOne') {\n      return !!contexts.query || Object.keys(contexts).length === 0;\n    }\n    if (hook.name === 'validate' || hook.name === 'remove') {\n      return !!contexts.query;\n    }\n    if (hook.query != null || hook.document != null) {\n      return !!hook.query;\n    }\n    return true;\n  });\n\n  // `update()` thunk has a different name because `_update` was already taken\n  Query.prototype._execUpdate = middleware.createWrapper('update', Query.prototype._execUpdate, null, kareemOptions);\n  // `distinct()` thunk has a different name because `_distinct` was already taken\n  Query.prototype.__distinct = middleware.createWrapper('distinct', Query.prototype.__distinct, null, kareemOptions);\n\n  // `validate()` doesn't have a thunk because it doesn't execute a query.\n  Query.prototype.validate = middleware.createWrapper('validate', Query.prototype.validate, null, kareemOptions);\n  applyQueryMiddleware.middlewareFunctions.filter(v => v !== 'update' && v !== 'distinct' && v !== 'validate').forEach(fn => {\n    Query.prototype[`_${fn}`] = middleware.createWrapper(fn, Query.prototype[`_${fn}`], null, kareemOptions);\n  });\n}\nfunction _getContexts(hook) {\n  const ret = {};\n  if (hook.hasOwnProperty('query')) {\n    ret.query = hook.query;\n  }\n  if (hook.hasOwnProperty('document')) {\n    ret.document = hook.document;\n  }\n  return ret;\n}","map":{"version":3,"names":["module","exports","applyQueryMiddleware","middlewareFunctions","Query","model","kareemOptions","useErrorHandlers","numCallbackParams","nullResultByDefault","middleware","hooks","filter","hook","contexts","_getContexts","name","query","Object","keys","length","document","prototype","_execUpdate","createWrapper","__distinct","validate","v","forEach","fn","ret","hasOwnProperty"],"sources":["/home/ctl/Documents/nodejs/node_modules/mongoose/lib/helpers/query/applyQueryMiddleware.js"],"sourcesContent":["'use strict';\n\n/*!\n * ignore\n */\n\nmodule.exports = applyQueryMiddleware;\n\n/*!\n * ignore\n */\n\napplyQueryMiddleware.middlewareFunctions = [\n  'count',\n  'countDocuments',\n  'deleteMany',\n  'deleteOne',\n  'distinct',\n  'estimatedDocumentCount',\n  'find',\n  'findOne',\n  'findOneAndDelete',\n  'findOneAndRemove',\n  'findOneAndReplace',\n  'findOneAndUpdate',\n  'remove',\n  'replaceOne',\n  'update',\n  'updateMany',\n  'updateOne',\n  'validate'\n];\n\n/*!\n * Apply query middleware\n *\n * @param {Query} query constructor\n * @param {Model} model\n */\n\nfunction applyQueryMiddleware(Query, model) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1,\n    nullResultByDefault: true\n  };\n\n  const middleware = model.hooks.filter(hook => {\n    const contexts = _getContexts(hook);\n    if (hook.name === 'updateOne') {\n      return contexts.query == null || !!contexts.query;\n    }\n    if (hook.name === 'deleteOne') {\n      return !!contexts.query || Object.keys(contexts).length === 0;\n    }\n    if (hook.name === 'validate' || hook.name === 'remove') {\n      return !!contexts.query;\n    }\n    if (hook.query != null || hook.document != null) {\n      return !!hook.query;\n    }\n    return true;\n  });\n\n  // `update()` thunk has a different name because `_update` was already taken\n  Query.prototype._execUpdate = middleware.createWrapper('update',\n    Query.prototype._execUpdate, null, kareemOptions);\n  // `distinct()` thunk has a different name because `_distinct` was already taken\n  Query.prototype.__distinct = middleware.createWrapper('distinct',\n    Query.prototype.__distinct, null, kareemOptions);\n\n  // `validate()` doesn't have a thunk because it doesn't execute a query.\n  Query.prototype.validate = middleware.createWrapper('validate',\n    Query.prototype.validate, null, kareemOptions);\n\n  applyQueryMiddleware.middlewareFunctions.\n    filter(v => v !== 'update' && v !== 'distinct' && v !== 'validate').\n    forEach(fn => {\n      Query.prototype[`_${fn}`] = middleware.createWrapper(fn,\n        Query.prototype[`_${fn}`], null, kareemOptions);\n    });\n}\n\nfunction _getContexts(hook) {\n  const ret = {};\n  if (hook.hasOwnProperty('query')) {\n    ret.query = hook.query;\n  }\n  if (hook.hasOwnProperty('document')) {\n    ret.document = hook.document;\n  }\n  return ret;\n}"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}