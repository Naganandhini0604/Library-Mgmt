{"ast":null,"code":"/* eslint no-func-assign: 1 */\n\n/*!\n * Module dependencies.\n */\n\n'use strict';\n\nconst Document = require('../document_provider')();\nconst EventEmitter = require('events').EventEmitter;\nconst ValidationError = require('../error/validation');\nconst immediate = require('../helpers/immediate');\nconst internalToObjectOptions = require('../options').internalToObjectOptions;\nconst get = require('../helpers/get');\nconst promiseOrCallback = require('../helpers/promiseOrCallback');\nconst util = require('util');\nconst documentArrayParent = require('../helpers/symbols').documentArrayParent;\nconst validatorErrorSymbol = require('../helpers/symbols').validatorErrorSymbol;\n\n/**\n * EmbeddedDocument constructor.\n *\n * @param {Object} obj js object returned from the db\n * @param {MongooseDocumentArray} parentArr the parent array of this document\n * @param {Boolean} skipId\n * @inherits Document\n * @api private\n */\n\nfunction EmbeddedDocument(obj, parentArr, skipId, fields, index) {\n  const options = {};\n  if (parentArr != null && parentArr.isMongooseDocumentArray) {\n    this.__parentArray = parentArr;\n    this[documentArrayParent] = parentArr.$parent();\n  } else {\n    this.__parentArray = undefined;\n    this[documentArrayParent] = undefined;\n  }\n  this.$setIndex(index);\n  this.$isDocumentArrayElement = true;\n  if (this[documentArrayParent] != null) {\n    options.defaults = this[documentArrayParent].$__.$options.defaults;\n  }\n  Document.call(this, obj, fields, skipId, options);\n  const _this = this;\n  this.on('isNew', function (val) {\n    _this.isNew = val;\n  });\n  _this.on('save', function () {\n    _this.constructor.emit('save', _this);\n  });\n}\n\n/*!\n * Inherit from Document\n */\nEmbeddedDocument.prototype = Object.create(Document.prototype);\nEmbeddedDocument.prototype.constructor = EmbeddedDocument;\nfor (const i in EventEmitter.prototype) {\n  EmbeddedDocument[i] = EventEmitter.prototype[i];\n}\nEmbeddedDocument.prototype.toBSON = function () {\n  return this.toObject(internalToObjectOptions);\n};\n\n/*!\n * ignore\n */\n\nEmbeddedDocument.prototype.$setIndex = function (index) {\n  this.__index = index;\n  if (get(this, '$__.validationError', null) != null) {\n    const keys = Object.keys(this.$__.validationError.errors);\n    for (const key of keys) {\n      this.invalidate(key, this.$__.validationError.errors[key]);\n    }\n  }\n};\n\n/**\n * Marks the embedded doc modified.\n *\n * ####Example:\n *\n *     const doc = blogpost.comments.id(hexstring);\n *     doc.mixed.type = 'changed';\n *     doc.markModified('mixed.type');\n *\n * @param {String} path the path which changed\n * @api public\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.markModified = function (path) {\n  this.$__.activePaths.modify(path);\n  if (!this.__parentArray) {\n    return;\n  }\n  const pathToCheck = this.__parentArray.$path() + '.0.' + path;\n  if (this.isNew && this.ownerDocument().$__isSelected(pathToCheck)) {\n    // Mark the WHOLE parent array as modified\n    // if this is a new document (i.e., we are initializing\n    // a document),\n    this.__parentArray._markModified();\n  } else {\n    this.__parentArray._markModified(this, path);\n  }\n};\n\n/*!\n * ignore\n */\n\nEmbeddedDocument.prototype.populate = function () {\n  throw new Error('Mongoose does not support calling populate() on nested ' + 'docs. Instead of `doc.arr[0].populate(\"path\")`, use ' + '`doc.populate(\"arr.0.path\")`');\n};\n\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nEmbeddedDocument.prototype.save = function (options, fn) {\n  if (typeof options === 'function') {\n    fn = options;\n    options = {};\n  }\n  options = options || {};\n  if (!options.suppressWarning) {\n    console.warn('mongoose: calling `save()` on a subdoc does **not** save ' + 'the document to MongoDB, it only runs save middleware. ' + 'Use `subdoc.save({ suppressWarning: true })` to hide this warning ' + 'if you\\'re sure this behavior is right for your app.');\n  }\n  return promiseOrCallback(fn, cb => {\n    this.$__save(cb);\n  });\n};\n\n/**\n * Used as a stub for middleware\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @method $__save\n * @api private\n */\n\nEmbeddedDocument.prototype.$__save = function (fn) {\n  return immediate(() => fn(null, this));\n};\n\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  let owner = sub.ownerDocument();\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    sub.constructor.emit('remove', sub);\n    owner = sub = null;\n  }\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n}\n\n/*!\n * no-op for hooks\n */\n\nEmbeddedDocument.prototype.$__remove = function (cb) {\n  if (cb == null) {\n    return;\n  }\n  return cb(null, this);\n};\n\n/**\n * Removes the subdocument from its parent array.\n *\n * @param {Object} [options]\n * @param {Function} [fn]\n * @api public\n */\n\nEmbeddedDocument.prototype.remove = function (options, fn) {\n  if (typeof options === 'function' && !fn) {\n    fn = options;\n    options = undefined;\n  }\n  if (!this.__parentArray || options && options.noop) {\n    this.$__remove(fn);\n    return this;\n  }\n  let _id;\n  if (!this.willRemove) {\n    _id = this._doc._id;\n    if (!_id) {\n      throw new Error('For your own good, Mongoose does not know ' + 'how to remove an EmbeddedDocument that has no _id');\n    }\n    this.__parentArray.pull({\n      _id: _id\n    });\n    this.willRemove = true;\n    registerRemoveListener(this);\n  }\n  this.$__remove(fn);\n  return this;\n};\n\n/**\n * Override #update method of parent documents.\n * @api private\n */\n\nEmbeddedDocument.prototype.update = function () {\n  throw new Error('The #update method is not available on EmbeddedDocuments');\n};\n\n/**\n * Helper for console.log\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.inspect = function () {\n  return this.toObject({\n    transform: false,\n    virtuals: false,\n    flattenDecimals: false\n  });\n};\nif (util.inspect.custom) {\n  /*!\n  * Avoid Node deprecation warning DEP0079\n  */\n\n  EmbeddedDocument.prototype[util.inspect.custom] = EmbeddedDocument.prototype.inspect;\n}\n\n/**\n * Marks a path as invalid, causing validation to fail.\n *\n * @param {String} path the field to invalidate\n * @param {String|Error} err error which states the reason `path` was invalid\n * @return {Boolean}\n * @api public\n */\n\nEmbeddedDocument.prototype.invalidate = function (path, err, val) {\n  Document.prototype.invalidate.call(this, path, err, val);\n  if (!this[documentArrayParent] || this.__index == null) {\n    if (err[validatorErrorSymbol] || err instanceof ValidationError) {\n      return this.ownerDocument().$__.validationError;\n    }\n    throw err;\n  }\n  const index = this.__index;\n  const parentPath = this.__parentArray.$path();\n  const fullPath = [parentPath, index, path].join('.');\n  this[documentArrayParent].invalidate(fullPath, err, val);\n  return this.ownerDocument().$__.validationError;\n};\n\n/**\n * Marks a path as valid, removing existing validation errors.\n *\n * @param {String} path the field to mark as valid\n * @api private\n * @method $markValid\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.$markValid = function (path) {\n  if (!this[documentArrayParent]) {\n    return;\n  }\n  const index = this.__index;\n  if (typeof index !== 'undefined') {\n    const parentPath = this.__parentArray.$path();\n    const fullPath = [parentPath, index, path].join('.');\n    this[documentArrayParent].$markValid(fullPath);\n  }\n};\n\n/*!\n * ignore\n */\n\nEmbeddedDocument.prototype.$ignore = function (path) {\n  Document.prototype.$ignore.call(this, path);\n  if (!this[documentArrayParent]) {\n    return;\n  }\n  const index = this.__index;\n  if (typeof index !== 'undefined') {\n    const parentPath = this.__parentArray.$path();\n    const fullPath = [parentPath, index, path].join('.');\n    this[documentArrayParent].$ignore(fullPath);\n  }\n};\n\n/**\n * Checks if a path is invalid\n *\n * @param {String} path the field to check\n * @api private\n * @method $isValid\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.$isValid = function (path) {\n  const index = this.__index;\n  if (typeof index !== 'undefined' && this[documentArrayParent]) {\n    return !this[documentArrayParent].$__.validationError || !this[documentArrayParent].$__.validationError.errors[this.$__fullPath(path)];\n  }\n  return true;\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nEmbeddedDocument.prototype.ownerDocument = function () {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n  let parent = this[documentArrayParent];\n  if (!parent) {\n    return this;\n  }\n  while (parent[documentArrayParent] || parent.$__parent) {\n    parent = parent[documentArrayParent] || parent.$__parent;\n  }\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n\n/**\n * Returns the full path to this document. If optional `path` is passed, it is appended to the full path.\n *\n * @param {String} [path]\n * @return {String}\n * @api private\n * @method $__fullPath\n * @memberOf EmbeddedDocument\n * @instance\n */\n\nEmbeddedDocument.prototype.$__fullPath = function (path) {\n  if (!this.$__.fullPath) {\n    let parent = this;\n    if (!parent[documentArrayParent]) {\n      return path;\n    }\n    const paths = [];\n    while (parent[documentArrayParent] || parent.$__parent) {\n      if (parent[documentArrayParent]) {\n        paths.unshift(parent.__parentArray.$path());\n      } else {\n        paths.unshift(parent.$basePath);\n      }\n      parent = parent[documentArrayParent] || parent.$__parent;\n    }\n    this.$__.fullPath = paths.join('.');\n    if (!this.$__.ownerDocument) {\n      // optimization\n      this.$__.ownerDocument = parent;\n    }\n  }\n  return path ? this.$__.fullPath + '.' + path : this.$__.fullPath;\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.parent = function () {\n  return this[documentArrayParent];\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.$parent = EmbeddedDocument.prototype.parent;\n\n/**\n * Returns this sub-documents parent array.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.parentArray = function () {\n  return this.__parentArray;\n};\n\n/*!\n * Module exports.\n */\n\nmodule.exports = EmbeddedDocument;","map":{"version":3,"names":["Document","require","EventEmitter","ValidationError","immediate","internalToObjectOptions","get","promiseOrCallback","util","documentArrayParent","validatorErrorSymbol","EmbeddedDocument","obj","parentArr","skipId","fields","index","options","isMongooseDocumentArray","__parentArray","$parent","undefined","$setIndex","$isDocumentArrayElement","defaults","$__","$options","call","_this","on","val","isNew","constructor","emit","prototype","Object","create","i","toBSON","toObject","__index","keys","validationError","errors","key","invalidate","markModified","path","activePaths","modify","pathToCheck","$path","ownerDocument","$__isSelected","_markModified","populate","Error","save","fn","suppressWarning","console","warn","cb","$__save","registerRemoveListener","sub","owner","emitRemove","removeListener","$__remove","remove","noop","_id","willRemove","_doc","pull","update","inspect","transform","virtuals","flattenDecimals","custom","err","parentPath","fullPath","join","$markValid","$ignore","$isValid","$__fullPath","parent","$__parent","paths","unshift","$basePath","parentArray","module","exports"],"sources":["/home/ctl/Documents/nodejs/node_modules/mongoose/lib/types/embedded.js"],"sourcesContent":["/* eslint no-func-assign: 1 */\n\n/*!\n * Module dependencies.\n */\n\n'use strict';\n\nconst Document = require('../document_provider')();\nconst EventEmitter = require('events').EventEmitter;\nconst ValidationError = require('../error/validation');\nconst immediate = require('../helpers/immediate');\nconst internalToObjectOptions = require('../options').internalToObjectOptions;\nconst get = require('../helpers/get');\nconst promiseOrCallback = require('../helpers/promiseOrCallback');\nconst util = require('util');\n\nconst documentArrayParent = require('../helpers/symbols').documentArrayParent;\nconst validatorErrorSymbol = require('../helpers/symbols').validatorErrorSymbol;\n\n/**\n * EmbeddedDocument constructor.\n *\n * @param {Object} obj js object returned from the db\n * @param {MongooseDocumentArray} parentArr the parent array of this document\n * @param {Boolean} skipId\n * @inherits Document\n * @api private\n */\n\nfunction EmbeddedDocument(obj, parentArr, skipId, fields, index) {\n  const options = {};\n  if (parentArr != null && parentArr.isMongooseDocumentArray) {\n    this.__parentArray = parentArr;\n    this[documentArrayParent] = parentArr.$parent();\n  } else {\n    this.__parentArray = undefined;\n    this[documentArrayParent] = undefined;\n  }\n  this.$setIndex(index);\n  this.$isDocumentArrayElement = true;\n\n  if (this[documentArrayParent] != null) {\n    options.defaults = this[documentArrayParent].$__.$options.defaults;\n  }\n\n  Document.call(this, obj, fields, skipId, options);\n\n  const _this = this;\n  this.on('isNew', function(val) {\n    _this.isNew = val;\n  });\n\n  _this.on('save', function() {\n    _this.constructor.emit('save', _this);\n  });\n}\n\n/*!\n * Inherit from Document\n */\nEmbeddedDocument.prototype = Object.create(Document.prototype);\nEmbeddedDocument.prototype.constructor = EmbeddedDocument;\n\nfor (const i in EventEmitter.prototype) {\n  EmbeddedDocument[i] = EventEmitter.prototype[i];\n}\n\nEmbeddedDocument.prototype.toBSON = function() {\n  return this.toObject(internalToObjectOptions);\n};\n\n/*!\n * ignore\n */\n\nEmbeddedDocument.prototype.$setIndex = function(index) {\n  this.__index = index;\n\n  if (get(this, '$__.validationError', null) != null) {\n    const keys = Object.keys(this.$__.validationError.errors);\n    for (const key of keys) {\n      this.invalidate(key, this.$__.validationError.errors[key]);\n    }\n  }\n};\n\n/**\n * Marks the embedded doc modified.\n *\n * ####Example:\n *\n *     const doc = blogpost.comments.id(hexstring);\n *     doc.mixed.type = 'changed';\n *     doc.markModified('mixed.type');\n *\n * @param {String} path the path which changed\n * @api public\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.markModified = function(path) {\n  this.$__.activePaths.modify(path);\n  if (!this.__parentArray) {\n    return;\n  }\n\n  const pathToCheck = this.__parentArray.$path() + '.0.' + path;\n  if (this.isNew && this.ownerDocument().$__isSelected(pathToCheck)) {\n    // Mark the WHOLE parent array as modified\n    // if this is a new document (i.e., we are initializing\n    // a document),\n    this.__parentArray._markModified();\n  } else {\n    this.__parentArray._markModified(this, path);\n  }\n};\n\n/*!\n * ignore\n */\n\nEmbeddedDocument.prototype.populate = function() {\n  throw new Error('Mongoose does not support calling populate() on nested ' +\n    'docs. Instead of `doc.arr[0].populate(\"path\")`, use ' +\n    '`doc.populate(\"arr.0.path\")`');\n};\n\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nEmbeddedDocument.prototype.save = function(options, fn) {\n  if (typeof options === 'function') {\n    fn = options;\n    options = {};\n  }\n  options = options || {};\n\n  if (!options.suppressWarning) {\n    console.warn('mongoose: calling `save()` on a subdoc does **not** save ' +\n      'the document to MongoDB, it only runs save middleware. ' +\n      'Use `subdoc.save({ suppressWarning: true })` to hide this warning ' +\n      'if you\\'re sure this behavior is right for your app.');\n  }\n\n  return promiseOrCallback(fn, cb => {\n    this.$__save(cb);\n  });\n};\n\n/**\n * Used as a stub for middleware\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @method $__save\n * @api private\n */\n\nEmbeddedDocument.prototype.$__save = function(fn) {\n  return immediate(() => fn(null, this));\n};\n\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  let owner = sub.ownerDocument();\n\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    sub.constructor.emit('remove', sub);\n    owner = sub = null;\n  }\n\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n}\n\n/*!\n * no-op for hooks\n */\n\nEmbeddedDocument.prototype.$__remove = function(cb) {\n  if (cb == null) {\n    return;\n  }\n  return cb(null, this);\n};\n\n/**\n * Removes the subdocument from its parent array.\n *\n * @param {Object} [options]\n * @param {Function} [fn]\n * @api public\n */\n\nEmbeddedDocument.prototype.remove = function(options, fn) {\n  if (typeof options === 'function' && !fn) {\n    fn = options;\n    options = undefined;\n  }\n  if (!this.__parentArray || (options && options.noop)) {\n    this.$__remove(fn);\n    return this;\n  }\n\n  let _id;\n  if (!this.willRemove) {\n    _id = this._doc._id;\n    if (!_id) {\n      throw new Error('For your own good, Mongoose does not know ' +\n          'how to remove an EmbeddedDocument that has no _id');\n    }\n    this.__parentArray.pull({ _id: _id });\n    this.willRemove = true;\n    registerRemoveListener(this);\n  }\n\n  this.$__remove(fn);\n\n  return this;\n};\n\n/**\n * Override #update method of parent documents.\n * @api private\n */\n\nEmbeddedDocument.prototype.update = function() {\n  throw new Error('The #update method is not available on EmbeddedDocuments');\n};\n\n/**\n * Helper for console.log\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.inspect = function() {\n  return this.toObject({\n    transform: false,\n    virtuals: false,\n    flattenDecimals: false\n  });\n};\n\nif (util.inspect.custom) {\n  /*!\n  * Avoid Node deprecation warning DEP0079\n  */\n\n  EmbeddedDocument.prototype[util.inspect.custom] = EmbeddedDocument.prototype.inspect;\n}\n\n/**\n * Marks a path as invalid, causing validation to fail.\n *\n * @param {String} path the field to invalidate\n * @param {String|Error} err error which states the reason `path` was invalid\n * @return {Boolean}\n * @api public\n */\n\nEmbeddedDocument.prototype.invalidate = function(path, err, val) {\n  Document.prototype.invalidate.call(this, path, err, val);\n\n  if (!this[documentArrayParent] || this.__index == null) {\n    if (err[validatorErrorSymbol] || err instanceof ValidationError) {\n      return this.ownerDocument().$__.validationError;\n    }\n    throw err;\n  }\n\n  const index = this.__index;\n  const parentPath = this.__parentArray.$path();\n  const fullPath = [parentPath, index, path].join('.');\n  this[documentArrayParent].invalidate(fullPath, err, val);\n\n  return this.ownerDocument().$__.validationError;\n};\n\n/**\n * Marks a path as valid, removing existing validation errors.\n *\n * @param {String} path the field to mark as valid\n * @api private\n * @method $markValid\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.$markValid = function(path) {\n  if (!this[documentArrayParent]) {\n    return;\n  }\n\n  const index = this.__index;\n  if (typeof index !== 'undefined') {\n    const parentPath = this.__parentArray.$path();\n    const fullPath = [parentPath, index, path].join('.');\n    this[documentArrayParent].$markValid(fullPath);\n  }\n};\n\n/*!\n * ignore\n */\n\nEmbeddedDocument.prototype.$ignore = function(path) {\n  Document.prototype.$ignore.call(this, path);\n\n  if (!this[documentArrayParent]) {\n    return;\n  }\n\n  const index = this.__index;\n  if (typeof index !== 'undefined') {\n    const parentPath = this.__parentArray.$path();\n    const fullPath = [parentPath, index, path].join('.');\n    this[documentArrayParent].$ignore(fullPath);\n  }\n};\n\n/**\n * Checks if a path is invalid\n *\n * @param {String} path the field to check\n * @api private\n * @method $isValid\n * @receiver EmbeddedDocument\n */\n\nEmbeddedDocument.prototype.$isValid = function(path) {\n  const index = this.__index;\n  if (typeof index !== 'undefined' && this[documentArrayParent]) {\n    return !this[documentArrayParent].$__.validationError ||\n      !this[documentArrayParent].$__.validationError.errors[this.$__fullPath(path)];\n  }\n\n  return true;\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nEmbeddedDocument.prototype.ownerDocument = function() {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  let parent = this[documentArrayParent];\n  if (!parent) {\n    return this;\n  }\n\n  while (parent[documentArrayParent] || parent.$__parent) {\n    parent = parent[documentArrayParent] || parent.$__parent;\n  }\n\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n\n/**\n * Returns the full path to this document. If optional `path` is passed, it is appended to the full path.\n *\n * @param {String} [path]\n * @return {String}\n * @api private\n * @method $__fullPath\n * @memberOf EmbeddedDocument\n * @instance\n */\n\nEmbeddedDocument.prototype.$__fullPath = function(path) {\n  if (!this.$__.fullPath) {\n    let parent = this;\n    if (!parent[documentArrayParent]) {\n      return path;\n    }\n\n    const paths = [];\n    while (parent[documentArrayParent] || parent.$__parent) {\n      if (parent[documentArrayParent]) {\n        paths.unshift(parent.__parentArray.$path());\n      } else {\n        paths.unshift(parent.$basePath);\n      }\n      parent = parent[documentArrayParent] || parent.$__parent;\n    }\n\n    this.$__.fullPath = paths.join('.');\n\n    if (!this.$__.ownerDocument) {\n      // optimization\n      this.$__.ownerDocument = parent;\n    }\n  }\n\n  return path\n    ? this.$__.fullPath + '.' + path\n    : this.$__.fullPath;\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.parent = function() {\n  return this[documentArrayParent];\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.$parent = EmbeddedDocument.prototype.parent;\n\n/**\n * Returns this sub-documents parent array.\n *\n * @api public\n */\n\nEmbeddedDocument.prototype.parentArray = function() {\n  return this.__parentArray;\n};\n\n/*!\n * Module exports.\n */\n\nmodule.exports = EmbeddedDocument;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}