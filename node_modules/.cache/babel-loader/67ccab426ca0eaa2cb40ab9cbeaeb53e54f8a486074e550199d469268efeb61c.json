{"ast":null,"code":"'use strict';\n\nfunction Kareem() {\n  this._pres = new Map();\n  this._posts = new Map();\n}\nKareem.prototype.execPre = function (name, context, args, callback) {\n  if (arguments.length === 3) {\n    callback = args;\n    args = [];\n  }\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n  var $args = args;\n  if (!numPres) {\n    return process.nextTick(function () {\n      callback(null);\n    });\n  }\n  var next = function () {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n    if (pre.isAsync) {\n      var args = [decorateNextFn(_next), decorateNextFn(function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n          done = true;\n          return callback(error);\n        }\n        if (--asyncPresLeft === 0 && currentPre >= numPres) {\n          return callback(null);\n        }\n      })];\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else if (pre.fn.length > 0) {\n      var args = [decorateNextFn(_next)];\n      var _args = arguments.length >= 2 ? arguments : [null].concat($args);\n      for (var i = 1; i < _args.length; ++i) {\n        args.push(_args[i]);\n      }\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else {\n      let maybePromise = null;\n      try {\n        maybePromise = pre.fn.call(context);\n      } catch (err) {\n        if (err != null) {\n          return callback(err);\n        }\n      }\n      if (isPromise(maybePromise)) {\n        maybePromise.then(() => _next(), err => _next(err));\n      } else {\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return process.nextTick(function () {\n              callback(null);\n            });\n          }\n        }\n        next();\n      }\n    }\n  };\n  next.apply(null, [null].concat(args));\n  function _next(error) {\n    if (error) {\n      if (done) {\n        return;\n      }\n      done = true;\n      return callback(error);\n    }\n    if (++currentPre >= numPres) {\n      if (asyncPresLeft > 0) {\n        // Leave parallel hooks to run\n        return;\n      } else {\n        return callback(null);\n      }\n    }\n    next.apply(context, arguments);\n  }\n};\nKareem.prototype.execPreSync = function (name, context, args) {\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.apply(context, args || []);\n  }\n};\nKareem.prototype.execPost = function (name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n  var posts = get(this._posts, name, []);\n  var numPosts = posts.length;\n  var currentPost = 0;\n  var firstError = null;\n  if (options && options.error) {\n    firstError = options.error;\n  }\n  if (!numPosts) {\n    return process.nextTick(function () {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n  var next = function () {\n    var post = posts[currentPost].fn;\n    var numArgs = 0;\n    var argLength = args.length;\n    var newArgs = [];\n    for (var i = 0; i < argLength; ++i) {\n      numArgs += args[i] && args[i]._kareemIgnore ? 0 : 1;\n      if (!args[i] || !args[i]._kareemIgnore) {\n        newArgs.push(args[i]);\n      }\n    }\n    if (firstError) {\n      if (post.length === numArgs + 2) {\n        var _cb = decorateNextFn(function (error) {\n          if (error) {\n            firstError = error;\n          }\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n          next();\n        });\n        callMiddlewareFunction(post, context, [firstError].concat(newArgs).concat([_cb]), _cb);\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n        next();\n      }\n    } else {\n      const _cb = decorateNextFn(function (error) {\n        if (error) {\n          firstError = error;\n          return next();\n        }\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n        next();\n      });\n      if (post.length === numArgs + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n        return next();\n      }\n      if (post.length === numArgs + 1) {\n        callMiddlewareFunction(post, context, newArgs.concat([_cb]), _cb);\n      } else {\n        let error;\n        let maybePromise;\n        try {\n          maybePromise = post.apply(context, newArgs);\n        } catch (err) {\n          error = err;\n          firstError = err;\n        }\n        if (isPromise(maybePromise)) {\n          return maybePromise.then(() => _cb(), err => _cb(err));\n        }\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [error].concat(args));\n        }\n        next(error);\n      }\n    }\n  };\n  next();\n};\nKareem.prototype.execPostSync = function (name, context, args) {\n  const posts = get(this._posts, name, []);\n  const numPosts = posts.length;\n  for (let i = 0; i < numPosts; ++i) {\n    posts[i].fn.apply(context, args || []);\n  }\n};\nKareem.prototype.createWrapperSync = function (name, fn) {\n  var kareem = this;\n  return function syncWrapper() {\n    kareem.execPreSync(name, this, arguments);\n    var toReturn = fn.apply(this, arguments);\n    kareem.execPostSync(name, this, [toReturn]);\n    return toReturn;\n  };\n};\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = {\n      error: error\n    };\n    return instance.execPost(name, context, args, _options, function (error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ? callback(error) : undefined;\n  }\n}\nKareem.prototype.wrap = function (name, fn, context, args, options) {\n  const lastArg = args.length > 0 ? args[args.length - 1] : null;\n  const argsWithoutCb = typeof lastArg === 'function' ? args.slice(0, args.length - 1) : args;\n  const _this = this;\n  options = options || {};\n  const checkForPromise = options.checkForPromise;\n  this.execPre(name, context, args, function (error) {\n    if (error) {\n      const numCallbackParams = options.numCallbackParams || 0;\n      const errorArgs = options.contextParameter ? [context] : [];\n      for (var i = errorArgs.length; i < numCallbackParams; ++i) {\n        errorArgs.push(null);\n      }\n      return _handleWrapError(_this, error, name, context, errorArgs, options, lastArg);\n    }\n    const end = typeof lastArg === 'function' ? args.length - 1 : args.length;\n    const numParameters = fn.length;\n    const ret = fn.apply(context, args.slice(0, end).concat(_cb));\n    if (checkForPromise) {\n      if (ret != null && typeof ret.then === 'function') {\n        // Thenable, use it\n        return ret.then(res => _cb(null, res), err => _cb(err));\n      }\n\n      // If `fn()` doesn't have a callback argument and doesn't return a\n      // promise, assume it is sync\n      if (numParameters < end + 1) {\n        return _cb(null, ret);\n      }\n    }\n    function _cb() {\n      const args = arguments;\n      const argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      if (options.nullResultByDefault && argsWithoutError.length === 0) {\n        argsWithoutError.push(null);\n      }\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context, argsWithoutError, options, lastArg);\n      } else {\n        _this.execPost(name, context, argsWithoutError, function () {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ? lastArg(arguments[0]) : undefined;\n          }\n          return typeof lastArg === 'function' ? lastArg.apply(context, arguments) : undefined;\n        });\n      }\n    }\n  });\n};\nKareem.prototype.filter = function (fn) {\n  const clone = this.clone();\n  const pres = Array.from(clone._pres.keys());\n  for (const name of pres) {\n    const hooks = this._pres.get(name).map(h => Object.assign({}, h, {\n      name: name\n    })).filter(fn);\n    if (hooks.length === 0) {\n      clone._pres.delete(name);\n      continue;\n    }\n    hooks.numAsync = hooks.filter(h => h.isAsync).length;\n    clone._pres.set(name, hooks);\n  }\n  const posts = Array.from(clone._posts.keys());\n  for (const name of posts) {\n    const hooks = this._posts.get(name).map(h => Object.assign({}, h, {\n      name: name\n    })).filter(fn);\n    if (hooks.length === 0) {\n      clone._posts.delete(name);\n      continue;\n    }\n    clone._posts.set(name, hooks);\n  }\n  return clone;\n};\nKareem.prototype.hasHooks = function (name) {\n  return this._pres.has(name) || this._posts.has(name);\n};\nKareem.prototype.createWrapper = function (name, fn, context, options) {\n  var _this = this;\n  if (!this.hasHooks(name)) {\n    // Fast path: if there's no hooks for this function, just return the\n    // function wrapped in a nextTick()\n    return function () {\n      process.nextTick(() => fn.apply(this, arguments));\n    };\n  }\n  return function () {\n    var _context = context || this;\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, _context, args, options);\n  };\n};\nKareem.prototype.pre = function (name, isAsync, fn, error, unshift) {\n  let options = {};\n  if (typeof isAsync === 'object' && isAsync != null) {\n    options = isAsync;\n    isAsync = options.isAsync;\n  } else if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n  const pres = get(this._pres, name, []);\n  this._pres.set(name, pres);\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n  if (typeof fn !== 'function') {\n    throw new Error('pre() requires a function, got \"' + typeof fn + '\"');\n  }\n  if (unshift) {\n    pres.unshift(Object.assign({}, options, {\n      fn: fn,\n      isAsync: isAsync\n    }));\n  } else {\n    pres.push(Object.assign({}, options, {\n      fn: fn,\n      isAsync: isAsync\n    }));\n  }\n  return this;\n};\nKareem.prototype.post = function (name, options, fn, unshift) {\n  const hooks = get(this._posts, name, []);\n  if (typeof options === 'function') {\n    unshift = !!fn;\n    fn = options;\n    options = {};\n  }\n  if (typeof fn !== 'function') {\n    throw new Error('post() requires a function, got \"' + typeof fn + '\"');\n  }\n  if (unshift) {\n    hooks.unshift(Object.assign({}, options, {\n      fn: fn\n    }));\n  } else {\n    hooks.push(Object.assign({}, options, {\n      fn: fn\n    }));\n  }\n  this._posts.set(name, hooks);\n  return this;\n};\nKareem.prototype.clone = function () {\n  const n = new Kareem();\n  for (let key of this._pres.keys()) {\n    const clone = this._pres.get(key).slice();\n    clone.numAsync = this._pres.get(key).numAsync;\n    n._pres.set(key, clone);\n  }\n  for (let key of this._posts.keys()) {\n    n._posts.set(key, this._posts.get(key).slice());\n  }\n  return n;\n};\nKareem.prototype.merge = function (other, clone) {\n  clone = arguments.length === 1 ? true : clone;\n  var ret = clone ? this.clone() : this;\n  for (let key of other._pres.keys()) {\n    const sourcePres = get(ret._pres, key, []);\n    const deduplicated = other._pres.get(key).\n    // Deduplicate based on `fn`\n    filter(p => sourcePres.map(_p => _p.fn).indexOf(p.fn) === -1);\n    const combined = sourcePres.concat(deduplicated);\n    combined.numAsync = sourcePres.numAsync || 0;\n    combined.numAsync += deduplicated.filter(p => p.isAsync).length;\n    ret._pres.set(key, combined);\n  }\n  for (let key of other._posts.keys()) {\n    const sourcePosts = get(ret._posts, key, []);\n    const deduplicated = other._posts.get(key).filter(p => sourcePosts.indexOf(p) === -1);\n    ret._posts.set(key, sourcePosts.concat(deduplicated));\n  }\n  return ret;\n};\nfunction get(map, key, def) {\n  if (map.has(key)) {\n    return map.get(key);\n  }\n  return def;\n}\nfunction callMiddlewareFunction(fn, context, args, next) {\n  let maybePromise;\n  try {\n    maybePromise = fn.apply(context, args);\n  } catch (error) {\n    return next(error);\n  }\n  if (isPromise(maybePromise)) {\n    maybePromise.then(() => next(), err => next(err));\n  }\n}\nfunction isPromise(v) {\n  return v != null && typeof v.then === 'function';\n}\nfunction decorateNextFn(fn) {\n  var called = false;\n  var _this = this;\n  return function () {\n    // Ensure this function can only be called once\n    if (called) {\n      return;\n    }\n    called = true;\n    // Make sure to clear the stack so try/catch doesn't catch errors\n    // in subsequent middleware\n    return process.nextTick(() => fn.apply(_this, arguments));\n  };\n}\nmodule.exports = Kareem;","map":{"version":3,"names":["Kareem","_pres","Map","_posts","prototype","execPre","name","context","args","callback","arguments","length","pres","get","numPres","numAsyncPres","numAsync","currentPre","asyncPresLeft","done","$args","process","nextTick","next","pre","isAsync","decorateNextFn","_next","error","callMiddlewareFunction","fn","_args","concat","i","push","maybePromise","call","err","isPromise","then","apply","execPreSync","execPost","options","posts","numPosts","currentPost","firstError","post","numArgs","argLength","newArgs","_kareemIgnore","_cb","execPostSync","createWrapperSync","kareem","syncWrapper","toReturn","_handleWrapError","instance","useErrorHandlers","_options","undefined","wrap","lastArg","argsWithoutCb","slice","_this","checkForPromise","numCallbackParams","errorArgs","contextParameter","end","numParameters","ret","res","argsWithoutError","Array","nullResultByDefault","filter","clone","from","keys","hooks","map","h","Object","assign","delete","set","hasHooks","has","createWrapper","_context","unshift","Error","n","key","merge","other","sourcePres","deduplicated","p","_p","indexOf","combined","sourcePosts","def","v","called","module","exports"],"sources":["/home/ctl/Documents/nodejs/node_modules/kareem/index.js"],"sourcesContent":["'use strict';\n\nfunction Kareem() {\n  this._pres = new Map();\n  this._posts = new Map();\n}\n\nKareem.prototype.execPre = function(name, context, args, callback) {\n  if (arguments.length === 3) {\n    callback = args;\n    args = [];\n  }\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n  var $args = args;\n\n  if (!numPres) {\n    return process.nextTick(function() {\n      callback(null);\n    });\n  }\n\n  var next = function() {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      var args = [\n        decorateNextFn(_next),\n        decorateNextFn(function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n          if (--asyncPresLeft === 0 && currentPre >= numPres) {\n            return callback(null);\n          }\n        })\n      ];\n\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else if (pre.fn.length > 0) {\n      var args = [decorateNextFn(_next)];\n      var _args = arguments.length >= 2 ? arguments : [null].concat($args);\n      for (var i = 1; i < _args.length; ++i) {\n        args.push(_args[i]);\n      }\n\n      callMiddlewareFunction(pre.fn, context, args, args[0]);\n    } else {\n      let maybePromise = null;\n      try {\n        maybePromise = pre.fn.call(context);\n      } catch (err) {\n        if (err != null) {\n          return callback(err);\n        }\n      }\n\n      if (isPromise(maybePromise)) {\n        maybePromise.then(() => _next(), err => _next(err));\n      } else {\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return process.nextTick(function() {\n              callback(null);\n            });\n          }\n        }\n        next();\n      }\n    }\n  };\n\n  next.apply(null, [null].concat(args));\n\n  function _next(error) {\n    if (error) {\n      if (done) {\n        return;\n      }\n      done = true;\n      return callback(error);\n    }\n\n    if (++currentPre >= numPres) {\n      if (asyncPresLeft > 0) {\n        // Leave parallel hooks to run\n        return;\n      } else {\n        return callback(null);\n      }\n    }\n\n    next.apply(context, arguments);\n  }\n};\n\nKareem.prototype.execPreSync = function(name, context, args) {\n  var pres = get(this._pres, name, []);\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.apply(context, args || []);\n  }\n};\n\nKareem.prototype.execPost = function(name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n  var posts = get(this._posts, name, []);\n  var numPosts = posts.length;\n  var currentPost = 0;\n\n  var firstError = null;\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function() {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function() {\n    var post = posts[currentPost].fn;\n    var numArgs = 0;\n    var argLength = args.length;\n    var newArgs = [];\n    for (var i = 0; i < argLength; ++i) {\n      numArgs += args[i] && args[i]._kareemIgnore ? 0 : 1;\n      if (!args[i] || !args[i]._kareemIgnore) {\n        newArgs.push(args[i]);\n      }\n    }\n\n    if (firstError) {\n      if (post.length === numArgs + 2) {\n        var _cb = decorateNextFn(function(error) {\n          if (error) {\n            firstError = error;\n          }\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n          next();\n        });\n\n        callMiddlewareFunction(post, context,\n          [firstError].concat(newArgs).concat([_cb]), _cb);\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n        next();\n      }\n    } else {\n      const _cb = decorateNextFn(function(error) {\n        if (error) {\n          firstError = error;\n          return next();\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      });\n\n      if (post.length === numArgs + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n        return next();\n      }\n      if (post.length === numArgs + 1) {\n        callMiddlewareFunction(post, context, newArgs.concat([_cb]), _cb);\n      } else {\n        let error;\n        let maybePromise;\n        try {\n          maybePromise = post.apply(context, newArgs);\n        } catch (err) {\n          error = err;\n          firstError = err;\n        }\n\n        if (isPromise(maybePromise)) {\n          return maybePromise.then(() => _cb(), err => _cb(err));\n        }\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [error].concat(args));\n        }\n\n        next(error);\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function(name, context, args) {\n  const posts = get(this._posts, name, []);\n  const numPosts = posts.length;\n\n  for (let i = 0; i < numPosts; ++i) {\n    posts[i].fn.apply(context, args || []);\n  }\n};\n\nKareem.prototype.createWrapperSync = function(name, fn) {\n  var kareem = this;\n  return function syncWrapper() {\n    kareem.execPreSync(name, this, arguments);\n\n    var toReturn = fn.apply(this, arguments);\n\n    kareem.execPostSync(name, this, [toReturn]);\n\n    return toReturn;\n  };\n}\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = { error: error };\n    return instance.execPost(name, context, args, _options, function(error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ?\n      callback(error) :\n      undefined;\n  }\n}\n\nKareem.prototype.wrap = function(name, fn, context, args, options) {\n  const lastArg = (args.length > 0 ? args[args.length - 1] : null);\n  const argsWithoutCb = typeof lastArg === 'function' ?\n    args.slice(0, args.length - 1) :\n    args;\n  const _this = this;\n\n  options = options || {};\n  const checkForPromise = options.checkForPromise;\n\n  this.execPre(name, context, args, function(error) {\n    if (error) {\n      const numCallbackParams = options.numCallbackParams || 0;\n      const errorArgs = options.contextParameter ? [context] : [];\n      for (var i = errorArgs.length; i < numCallbackParams; ++i) {\n        errorArgs.push(null);\n      }\n      return _handleWrapError(_this, error, name, context, errorArgs,\n        options, lastArg);\n    }\n\n    const end = (typeof lastArg === 'function' ? args.length - 1 : args.length);\n    const numParameters = fn.length;\n    const ret = fn.apply(context, args.slice(0, end).concat(_cb));\n\n    if (checkForPromise) {\n      if (ret != null && typeof ret.then === 'function') {\n        // Thenable, use it\n        return ret.then(\n          res => _cb(null, res),\n          err => _cb(err)\n        );\n      }\n\n      // If `fn()` doesn't have a callback argument and doesn't return a\n      // promise, assume it is sync\n      if (numParameters < end + 1) {\n        return _cb(null, ret);\n      }\n    }\n\n    function _cb() {\n      const args = arguments;\n      const argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      if (options.nullResultByDefault && argsWithoutError.length === 0) {\n        argsWithoutError.push(null);\n      }\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context,\n          argsWithoutError, options, lastArg);\n      } else {\n        _this.execPost(name, context, argsWithoutError, function() {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ?\n              lastArg(arguments[0]) :\n              undefined;\n          }\n\n          return typeof lastArg === 'function' ?\n            lastArg.apply(context, arguments) :\n            undefined;\n        });\n      }\n    }\n  });\n};\n\nKareem.prototype.filter = function(fn) {\n  const clone = this.clone();\n\n  const pres = Array.from(clone._pres.keys());\n  for (const name of pres) {\n    const hooks = this._pres.get(name).\n      map(h => Object.assign({}, h, { name: name })).\n      filter(fn);\n\n    if (hooks.length === 0) {\n      clone._pres.delete(name);\n      continue;\n    }\n\n    hooks.numAsync = hooks.filter(h => h.isAsync).length;\n\n    clone._pres.set(name, hooks);\n  }\n\n  const posts = Array.from(clone._posts.keys());\n  for (const name of posts) {\n    const hooks = this._posts.get(name).\n      map(h => Object.assign({}, h, { name: name })).\n      filter(fn);\n\n    if (hooks.length === 0) {\n      clone._posts.delete(name);\n      continue;\n    }\n\n    clone._posts.set(name, hooks);\n  }\n\n  return clone;\n};\n\nKareem.prototype.hasHooks = function(name) {\n  return this._pres.has(name) || this._posts.has(name);\n};\n\nKareem.prototype.createWrapper = function(name, fn, context, options) {\n  var _this = this;\n  if (!this.hasHooks(name)) {\n    // Fast path: if there's no hooks for this function, just return the\n    // function wrapped in a nextTick()\n    return function() {\n      process.nextTick(() => fn.apply(this, arguments));\n    };\n  }\n  return function() {\n    var _context = context || this;\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, _context, args, options);\n  };\n};\n\nKareem.prototype.pre = function(name, isAsync, fn, error, unshift) {\n  let options = {};\n  if (typeof isAsync === 'object' && isAsync != null) {\n    options = isAsync;\n    isAsync = options.isAsync;\n  } else if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  const pres = get(this._pres, name, []);\n  this._pres.set(name, pres);\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  if (typeof fn !== 'function') {\n    throw new Error('pre() requires a function, got \"' + typeof fn + '\"');\n  }\n\n  if (unshift) {\n    pres.unshift(Object.assign({}, options, { fn: fn, isAsync: isAsync }));\n  } else {\n    pres.push(Object.assign({}, options, { fn: fn, isAsync: isAsync }));\n  }\n\n  return this;\n};\n\nKareem.prototype.post = function(name, options, fn, unshift) {\n  const hooks = get(this._posts, name, []);\n\n  if (typeof options === 'function') {\n    unshift = !!fn;\n    fn = options;\n    options = {};\n  }\n\n  if (typeof fn !== 'function') {\n    throw new Error('post() requires a function, got \"' + typeof fn + '\"');\n  }\n\n  if (unshift) {\n    hooks.unshift(Object.assign({}, options, { fn: fn }));\n  } else {\n    hooks.push(Object.assign({}, options, { fn: fn }));\n  }\n  this._posts.set(name, hooks);\n  return this;\n};\n\nKareem.prototype.clone = function() {\n  const n = new Kareem();\n\n  for (let key of this._pres.keys()) {\n    const clone = this._pres.get(key).slice();\n    clone.numAsync = this._pres.get(key).numAsync;\n    n._pres.set(key, clone);\n  }\n  for (let key of this._posts.keys()) {\n    n._posts.set(key, this._posts.get(key).slice());\n  }\n\n  return n;\n};\n\nKareem.prototype.merge = function(other, clone) {\n  clone = arguments.length === 1 ? true : clone;\n  var ret = clone ? this.clone() : this;\n\n  for (let key of other._pres.keys()) {\n    const sourcePres = get(ret._pres, key, []);\n    const deduplicated = other._pres.get(key).\n      // Deduplicate based on `fn`\n      filter(p => sourcePres.map(_p => _p.fn).indexOf(p.fn) === -1);\n    const combined = sourcePres.concat(deduplicated);\n    combined.numAsync = sourcePres.numAsync || 0;\n    combined.numAsync += deduplicated.filter(p => p.isAsync).length;\n    ret._pres.set(key, combined);\n  }\n  for (let key of other._posts.keys()) {\n    const sourcePosts = get(ret._posts, key, []);\n    const deduplicated = other._posts.get(key).\n      filter(p => sourcePosts.indexOf(p) === -1);\n    ret._posts.set(key, sourcePosts.concat(deduplicated));\n  }\n\n  return ret;\n};\n\nfunction get(map, key, def) {\n  if (map.has(key)) {\n    return map.get(key);\n  }\n  return def;\n}\n\nfunction callMiddlewareFunction(fn, context, args, next) {\n  let maybePromise;\n  try {\n    maybePromise = fn.apply(context, args);\n  } catch (error) {\n    return next(error);\n  }\n\n  if (isPromise(maybePromise)) {\n    maybePromise.then(() => next(), err => next(err));\n  }\n}\n\nfunction isPromise(v) {\n  return v != null && typeof v.then === 'function';\n}\n\nfunction decorateNextFn(fn) {\n  var called = false;\n  var _this = this;\n  return function() {\n    // Ensure this function can only be called once\n    if (called) {\n      return;\n    }\n    called = true;\n    // Make sure to clear the stack so try/catch doesn't catch errors\n    // in subsequent middleware\n    return process.nextTick(() => fn.apply(_this, arguments));\n  };\n}\n\nmodule.exports = Kareem;\n"],"mappings":"AAAA,YAAY;;AAEZ,SAASA,MAAM,GAAG;EAChB,IAAI,CAACC,KAAK,GAAG,IAAIC,GAAG,EAAE;EACtB,IAAI,CAACC,MAAM,GAAG,IAAID,GAAG,EAAE;AACzB;AAEAF,MAAM,CAACI,SAAS,CAACC,OAAO,GAAG,UAASC,IAAI,EAAEC,OAAO,EAAEC,IAAI,EAAEC,QAAQ,EAAE;EACjE,IAAIC,SAAS,CAACC,MAAM,KAAK,CAAC,EAAE;IAC1BF,QAAQ,GAAGD,IAAI;IACfA,IAAI,GAAG,EAAE;EACX;EACA,IAAII,IAAI,GAAGC,GAAG,CAAC,IAAI,CAACZ,KAAK,EAAEK,IAAI,EAAE,EAAE,CAAC;EACpC,IAAIQ,OAAO,GAAGF,IAAI,CAACD,MAAM;EACzB,IAAII,YAAY,GAAGH,IAAI,CAACI,QAAQ,IAAI,CAAC;EACrC,IAAIC,UAAU,GAAG,CAAC;EAClB,IAAIC,aAAa,GAAGH,YAAY;EAChC,IAAII,IAAI,GAAG,KAAK;EAChB,IAAIC,KAAK,GAAGZ,IAAI;EAEhB,IAAI,CAACM,OAAO,EAAE;IACZ,OAAOO,OAAO,CAACC,QAAQ,CAAC,YAAW;MACjCb,QAAQ,CAAC,IAAI,CAAC;IAChB,CAAC,CAAC;EACJ;EAEA,IAAIc,IAAI,GAAG,YAAW;IACpB,IAAIN,UAAU,IAAIH,OAAO,EAAE;MACzB;IACF;IACA,IAAIU,GAAG,GAAGZ,IAAI,CAACK,UAAU,CAAC;IAE1B,IAAIO,GAAG,CAACC,OAAO,EAAE;MACf,IAAIjB,IAAI,GAAG,CACTkB,cAAc,CAACC,KAAK,CAAC,EACrBD,cAAc,CAAC,UAASE,KAAK,EAAE;QAC7B,IAAIA,KAAK,EAAE;UACT,IAAIT,IAAI,EAAE;YACR;UACF;UACAA,IAAI,GAAG,IAAI;UACX,OAAOV,QAAQ,CAACmB,KAAK,CAAC;QACxB;QACA,IAAI,EAAEV,aAAa,KAAK,CAAC,IAAID,UAAU,IAAIH,OAAO,EAAE;UAClD,OAAOL,QAAQ,CAAC,IAAI,CAAC;QACvB;MACF,CAAC,CAAC,CACH;MAEDoB,sBAAsB,CAACL,GAAG,CAACM,EAAE,EAAEvB,OAAO,EAAEC,IAAI,EAAEA,IAAI,CAAC,CAAC,CAAC,CAAC;IACxD,CAAC,MAAM,IAAIgB,GAAG,CAACM,EAAE,CAACnB,MAAM,GAAG,CAAC,EAAE;MAC5B,IAAIH,IAAI,GAAG,CAACkB,cAAc,CAACC,KAAK,CAAC,CAAC;MAClC,IAAII,KAAK,GAAGrB,SAAS,CAACC,MAAM,IAAI,CAAC,GAAGD,SAAS,GAAG,CAAC,IAAI,CAAC,CAACsB,MAAM,CAACZ,KAAK,CAAC;MACpE,KAAK,IAAIa,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,KAAK,CAACpB,MAAM,EAAE,EAAEsB,CAAC,EAAE;QACrCzB,IAAI,CAAC0B,IAAI,CAACH,KAAK,CAACE,CAAC,CAAC,CAAC;MACrB;MAEAJ,sBAAsB,CAACL,GAAG,CAACM,EAAE,EAAEvB,OAAO,EAAEC,IAAI,EAAEA,IAAI,CAAC,CAAC,CAAC,CAAC;IACxD,CAAC,MAAM;MACL,IAAI2B,YAAY,GAAG,IAAI;MACvB,IAAI;QACFA,YAAY,GAAGX,GAAG,CAACM,EAAE,CAACM,IAAI,CAAC7B,OAAO,CAAC;MACrC,CAAC,CAAC,OAAO8B,GAAG,EAAE;QACZ,IAAIA,GAAG,IAAI,IAAI,EAAE;UACf,OAAO5B,QAAQ,CAAC4B,GAAG,CAAC;QACtB;MACF;MAEA,IAAIC,SAAS,CAACH,YAAY,CAAC,EAAE;QAC3BA,YAAY,CAACI,IAAI,CAAC,MAAMZ,KAAK,EAAE,EAAEU,GAAG,IAAIV,KAAK,CAACU,GAAG,CAAC,CAAC;MACrD,CAAC,MAAM;QACL,IAAI,EAAEpB,UAAU,IAAIH,OAAO,EAAE;UAC3B,IAAII,aAAa,GAAG,CAAC,EAAE;YACrB;YACA;UACF,CAAC,MAAM;YACL,OAAOG,OAAO,CAACC,QAAQ,CAAC,YAAW;cACjCb,QAAQ,CAAC,IAAI,CAAC;YAChB,CAAC,CAAC;UACJ;QACF;QACAc,IAAI,EAAE;MACR;IACF;EACF,CAAC;EAEDA,IAAI,CAACiB,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAACR,MAAM,CAACxB,IAAI,CAAC,CAAC;EAErC,SAASmB,KAAK,CAACC,KAAK,EAAE;IACpB,IAAIA,KAAK,EAAE;MACT,IAAIT,IAAI,EAAE;QACR;MACF;MACAA,IAAI,GAAG,IAAI;MACX,OAAOV,QAAQ,CAACmB,KAAK,CAAC;IACxB;IAEA,IAAI,EAAEX,UAAU,IAAIH,OAAO,EAAE;MAC3B,IAAII,aAAa,GAAG,CAAC,EAAE;QACrB;QACA;MACF,CAAC,MAAM;QACL,OAAOT,QAAQ,CAAC,IAAI,CAAC;MACvB;IACF;IAEAc,IAAI,CAACiB,KAAK,CAACjC,OAAO,EAAEG,SAAS,CAAC;EAChC;AACF,CAAC;AAEDV,MAAM,CAACI,SAAS,CAACqC,WAAW,GAAG,UAASnC,IAAI,EAAEC,OAAO,EAAEC,IAAI,EAAE;EAC3D,IAAII,IAAI,GAAGC,GAAG,CAAC,IAAI,CAACZ,KAAK,EAAEK,IAAI,EAAE,EAAE,CAAC;EACpC,IAAIQ,OAAO,GAAGF,IAAI,CAACD,MAAM;EAEzB,KAAK,IAAIsB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGnB,OAAO,EAAE,EAAEmB,CAAC,EAAE;IAChCrB,IAAI,CAACqB,CAAC,CAAC,CAACH,EAAE,CAACU,KAAK,CAACjC,OAAO,EAAEC,IAAI,IAAI,EAAE,CAAC;EACvC;AACF,CAAC;AAEDR,MAAM,CAACI,SAAS,CAACsC,QAAQ,GAAG,UAASpC,IAAI,EAAEC,OAAO,EAAEC,IAAI,EAAEmC,OAAO,EAAElC,QAAQ,EAAE;EAC3E,IAAIC,SAAS,CAACC,MAAM,GAAG,CAAC,EAAE;IACxBF,QAAQ,GAAGkC,OAAO;IAClBA,OAAO,GAAG,IAAI;EAChB;EACA,IAAIC,KAAK,GAAG/B,GAAG,CAAC,IAAI,CAACV,MAAM,EAAEG,IAAI,EAAE,EAAE,CAAC;EACtC,IAAIuC,QAAQ,GAAGD,KAAK,CAACjC,MAAM;EAC3B,IAAImC,WAAW,GAAG,CAAC;EAEnB,IAAIC,UAAU,GAAG,IAAI;EACrB,IAAIJ,OAAO,IAAIA,OAAO,CAACf,KAAK,EAAE;IAC5BmB,UAAU,GAAGJ,OAAO,CAACf,KAAK;EAC5B;EAEA,IAAI,CAACiB,QAAQ,EAAE;IACb,OAAOxB,OAAO,CAACC,QAAQ,CAAC,YAAW;MACjCb,QAAQ,CAAC+B,KAAK,CAAC,IAAI,EAAE,CAACO,UAAU,CAAC,CAACf,MAAM,CAACxB,IAAI,CAAC,CAAC;IACjD,CAAC,CAAC;EACJ;EAEA,IAAIe,IAAI,GAAG,YAAW;IACpB,IAAIyB,IAAI,GAAGJ,KAAK,CAACE,WAAW,CAAC,CAAChB,EAAE;IAChC,IAAImB,OAAO,GAAG,CAAC;IACf,IAAIC,SAAS,GAAG1C,IAAI,CAACG,MAAM;IAC3B,IAAIwC,OAAO,GAAG,EAAE;IAChB,KAAK,IAAIlB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGiB,SAAS,EAAE,EAAEjB,CAAC,EAAE;MAClCgB,OAAO,IAAIzC,IAAI,CAACyB,CAAC,CAAC,IAAIzB,IAAI,CAACyB,CAAC,CAAC,CAACmB,aAAa,GAAG,CAAC,GAAG,CAAC;MACnD,IAAI,CAAC5C,IAAI,CAACyB,CAAC,CAAC,IAAI,CAACzB,IAAI,CAACyB,CAAC,CAAC,CAACmB,aAAa,EAAE;QACtCD,OAAO,CAACjB,IAAI,CAAC1B,IAAI,CAACyB,CAAC,CAAC,CAAC;MACvB;IACF;IAEA,IAAIc,UAAU,EAAE;MACd,IAAIC,IAAI,CAACrC,MAAM,KAAKsC,OAAO,GAAG,CAAC,EAAE;QAC/B,IAAII,GAAG,GAAG3B,cAAc,CAAC,UAASE,KAAK,EAAE;UACvC,IAAIA,KAAK,EAAE;YACTmB,UAAU,GAAGnB,KAAK;UACpB;UACA,IAAI,EAAEkB,WAAW,IAAID,QAAQ,EAAE;YAC7B,OAAOpC,QAAQ,CAAC2B,IAAI,CAAC,IAAI,EAAEW,UAAU,CAAC;UACxC;UACAxB,IAAI,EAAE;QACR,CAAC,CAAC;QAEFM,sBAAsB,CAACmB,IAAI,EAAEzC,OAAO,EAClC,CAACwC,UAAU,CAAC,CAACf,MAAM,CAACmB,OAAO,CAAC,CAACnB,MAAM,CAAC,CAACqB,GAAG,CAAC,CAAC,EAAEA,GAAG,CAAC;MACpD,CAAC,MAAM;QACL,IAAI,EAAEP,WAAW,IAAID,QAAQ,EAAE;UAC7B,OAAOpC,QAAQ,CAAC2B,IAAI,CAAC,IAAI,EAAEW,UAAU,CAAC;QACxC;QACAxB,IAAI,EAAE;MACR;IACF,CAAC,MAAM;MACL,MAAM8B,GAAG,GAAG3B,cAAc,CAAC,UAASE,KAAK,EAAE;QACzC,IAAIA,KAAK,EAAE;UACTmB,UAAU,GAAGnB,KAAK;UAClB,OAAOL,IAAI,EAAE;QACf;QAEA,IAAI,EAAEuB,WAAW,IAAID,QAAQ,EAAE;UAC7B,OAAOpC,QAAQ,CAAC+B,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAACR,MAAM,CAACxB,IAAI,CAAC,CAAC;QAClD;QAEAe,IAAI,EAAE;MACR,CAAC,CAAC;MAEF,IAAIyB,IAAI,CAACrC,MAAM,KAAKsC,OAAO,GAAG,CAAC,EAAE;QAC/B;QACA,IAAI,EAAEH,WAAW,IAAID,QAAQ,EAAE;UAC7B,OAAOpC,QAAQ,CAAC+B,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAACR,MAAM,CAACxB,IAAI,CAAC,CAAC;QAClD;QACA,OAAOe,IAAI,EAAE;MACf;MACA,IAAIyB,IAAI,CAACrC,MAAM,KAAKsC,OAAO,GAAG,CAAC,EAAE;QAC/BpB,sBAAsB,CAACmB,IAAI,EAAEzC,OAAO,EAAE4C,OAAO,CAACnB,MAAM,CAAC,CAACqB,GAAG,CAAC,CAAC,EAAEA,GAAG,CAAC;MACnE,CAAC,MAAM;QACL,IAAIzB,KAAK;QACT,IAAIO,YAAY;QAChB,IAAI;UACFA,YAAY,GAAGa,IAAI,CAACR,KAAK,CAACjC,OAAO,EAAE4C,OAAO,CAAC;QAC7C,CAAC,CAAC,OAAOd,GAAG,EAAE;UACZT,KAAK,GAAGS,GAAG;UACXU,UAAU,GAAGV,GAAG;QAClB;QAEA,IAAIC,SAAS,CAACH,YAAY,CAAC,EAAE;UAC3B,OAAOA,YAAY,CAACI,IAAI,CAAC,MAAMc,GAAG,EAAE,EAAEhB,GAAG,IAAIgB,GAAG,CAAChB,GAAG,CAAC,CAAC;QACxD;QAEA,IAAI,EAAES,WAAW,IAAID,QAAQ,EAAE;UAC7B,OAAOpC,QAAQ,CAAC+B,KAAK,CAAC,IAAI,EAAE,CAACZ,KAAK,CAAC,CAACI,MAAM,CAACxB,IAAI,CAAC,CAAC;QACnD;QAEAe,IAAI,CAACK,KAAK,CAAC;MACb;IACF;EACF,CAAC;EAEDL,IAAI,EAAE;AACR,CAAC;AAEDvB,MAAM,CAACI,SAAS,CAACkD,YAAY,GAAG,UAAShD,IAAI,EAAEC,OAAO,EAAEC,IAAI,EAAE;EAC5D,MAAMoC,KAAK,GAAG/B,GAAG,CAAC,IAAI,CAACV,MAAM,EAAEG,IAAI,EAAE,EAAE,CAAC;EACxC,MAAMuC,QAAQ,GAAGD,KAAK,CAACjC,MAAM;EAE7B,KAAK,IAAIsB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGY,QAAQ,EAAE,EAAEZ,CAAC,EAAE;IACjCW,KAAK,CAACX,CAAC,CAAC,CAACH,EAAE,CAACU,KAAK,CAACjC,OAAO,EAAEC,IAAI,IAAI,EAAE,CAAC;EACxC;AACF,CAAC;AAEDR,MAAM,CAACI,SAAS,CAACmD,iBAAiB,GAAG,UAASjD,IAAI,EAAEwB,EAAE,EAAE;EACtD,IAAI0B,MAAM,GAAG,IAAI;EACjB,OAAO,SAASC,WAAW,GAAG;IAC5BD,MAAM,CAACf,WAAW,CAACnC,IAAI,EAAE,IAAI,EAAEI,SAAS,CAAC;IAEzC,IAAIgD,QAAQ,GAAG5B,EAAE,CAACU,KAAK,CAAC,IAAI,EAAE9B,SAAS,CAAC;IAExC8C,MAAM,CAACF,YAAY,CAAChD,IAAI,EAAE,IAAI,EAAE,CAACoD,QAAQ,CAAC,CAAC;IAE3C,OAAOA,QAAQ;EACjB,CAAC;AACH,CAAC;AAED,SAASC,gBAAgB,CAACC,QAAQ,EAAEhC,KAAK,EAAEtB,IAAI,EAAEC,OAAO,EAAEC,IAAI,EAAEmC,OAAO,EAAElC,QAAQ,EAAE;EACjF,IAAIkC,OAAO,CAACkB,gBAAgB,EAAE;IAC5B,IAAIC,QAAQ,GAAG;MAAElC,KAAK,EAAEA;IAAM,CAAC;IAC/B,OAAOgC,QAAQ,CAAClB,QAAQ,CAACpC,IAAI,EAAEC,OAAO,EAAEC,IAAI,EAAEsD,QAAQ,EAAE,UAASlC,KAAK,EAAE;MACtE,OAAO,OAAOnB,QAAQ,KAAK,UAAU,IAAIA,QAAQ,CAACmB,KAAK,CAAC;IAC1D,CAAC,CAAC;EACJ,CAAC,MAAM;IACL,OAAO,OAAOnB,QAAQ,KAAK,UAAU,GACnCA,QAAQ,CAACmB,KAAK,CAAC,GACfmC,SAAS;EACb;AACF;AAEA/D,MAAM,CAACI,SAAS,CAAC4D,IAAI,GAAG,UAAS1D,IAAI,EAAEwB,EAAE,EAAEvB,OAAO,EAAEC,IAAI,EAAEmC,OAAO,EAAE;EACjE,MAAMsB,OAAO,GAAIzD,IAAI,CAACG,MAAM,GAAG,CAAC,GAAGH,IAAI,CAACA,IAAI,CAACG,MAAM,GAAG,CAAC,CAAC,GAAG,IAAK;EAChE,MAAMuD,aAAa,GAAG,OAAOD,OAAO,KAAK,UAAU,GACjDzD,IAAI,CAAC2D,KAAK,CAAC,CAAC,EAAE3D,IAAI,CAACG,MAAM,GAAG,CAAC,CAAC,GAC9BH,IAAI;EACN,MAAM4D,KAAK,GAAG,IAAI;EAElBzB,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;EACvB,MAAM0B,eAAe,GAAG1B,OAAO,CAAC0B,eAAe;EAE/C,IAAI,CAAChE,OAAO,CAACC,IAAI,EAAEC,OAAO,EAAEC,IAAI,EAAE,UAASoB,KAAK,EAAE;IAChD,IAAIA,KAAK,EAAE;MACT,MAAM0C,iBAAiB,GAAG3B,OAAO,CAAC2B,iBAAiB,IAAI,CAAC;MACxD,MAAMC,SAAS,GAAG5B,OAAO,CAAC6B,gBAAgB,GAAG,CAACjE,OAAO,CAAC,GAAG,EAAE;MAC3D,KAAK,IAAI0B,CAAC,GAAGsC,SAAS,CAAC5D,MAAM,EAAEsB,CAAC,GAAGqC,iBAAiB,EAAE,EAAErC,CAAC,EAAE;QACzDsC,SAAS,CAACrC,IAAI,CAAC,IAAI,CAAC;MACtB;MACA,OAAOyB,gBAAgB,CAACS,KAAK,EAAExC,KAAK,EAAEtB,IAAI,EAAEC,OAAO,EAAEgE,SAAS,EAC5D5B,OAAO,EAAEsB,OAAO,CAAC;IACrB;IAEA,MAAMQ,GAAG,GAAI,OAAOR,OAAO,KAAK,UAAU,GAAGzD,IAAI,CAACG,MAAM,GAAG,CAAC,GAAGH,IAAI,CAACG,MAAO;IAC3E,MAAM+D,aAAa,GAAG5C,EAAE,CAACnB,MAAM;IAC/B,MAAMgE,GAAG,GAAG7C,EAAE,CAACU,KAAK,CAACjC,OAAO,EAAEC,IAAI,CAAC2D,KAAK,CAAC,CAAC,EAAEM,GAAG,CAAC,CAACzC,MAAM,CAACqB,GAAG,CAAC,CAAC;IAE7D,IAAIgB,eAAe,EAAE;MACnB,IAAIM,GAAG,IAAI,IAAI,IAAI,OAAOA,GAAG,CAACpC,IAAI,KAAK,UAAU,EAAE;QACjD;QACA,OAAOoC,GAAG,CAACpC,IAAI,CACbqC,GAAG,IAAIvB,GAAG,CAAC,IAAI,EAAEuB,GAAG,CAAC,EACrBvC,GAAG,IAAIgB,GAAG,CAAChB,GAAG,CAAC,CAChB;MACH;;MAEA;MACA;MACA,IAAIqC,aAAa,GAAGD,GAAG,GAAG,CAAC,EAAE;QAC3B,OAAOpB,GAAG,CAAC,IAAI,EAAEsB,GAAG,CAAC;MACvB;IACF;IAEA,SAAStB,GAAG,GAAG;MACb,MAAM7C,IAAI,GAAGE,SAAS;MACtB,MAAMmE,gBAAgB,GAAGC,KAAK,CAAC1E,SAAS,CAAC+D,KAAK,CAAC/B,IAAI,CAAC1B,SAAS,EAAE,CAAC,CAAC;MACjE,IAAIiC,OAAO,CAACoC,mBAAmB,IAAIF,gBAAgB,CAAClE,MAAM,KAAK,CAAC,EAAE;QAChEkE,gBAAgB,CAAC3C,IAAI,CAAC,IAAI,CAAC;MAC7B;MACA,IAAIxB,SAAS,CAAC,CAAC,CAAC,EAAE;QAChB;QACA,OAAOiD,gBAAgB,CAACS,KAAK,EAAE1D,SAAS,CAAC,CAAC,CAAC,EAAEJ,IAAI,EAAEC,OAAO,EACxDsE,gBAAgB,EAAElC,OAAO,EAAEsB,OAAO,CAAC;MACvC,CAAC,MAAM;QACLG,KAAK,CAAC1B,QAAQ,CAACpC,IAAI,EAAEC,OAAO,EAAEsE,gBAAgB,EAAE,YAAW;UACzD,IAAInE,SAAS,CAAC,CAAC,CAAC,EAAE;YAChB,OAAO,OAAOuD,OAAO,KAAK,UAAU,GAClCA,OAAO,CAACvD,SAAS,CAAC,CAAC,CAAC,CAAC,GACrBqD,SAAS;UACb;UAEA,OAAO,OAAOE,OAAO,KAAK,UAAU,GAClCA,OAAO,CAACzB,KAAK,CAACjC,OAAO,EAAEG,SAAS,CAAC,GACjCqD,SAAS;QACb,CAAC,CAAC;MACJ;IACF;EACF,CAAC,CAAC;AACJ,CAAC;AAED/D,MAAM,CAACI,SAAS,CAAC4E,MAAM,GAAG,UAASlD,EAAE,EAAE;EACrC,MAAMmD,KAAK,GAAG,IAAI,CAACA,KAAK,EAAE;EAE1B,MAAMrE,IAAI,GAAGkE,KAAK,CAACI,IAAI,CAACD,KAAK,CAAChF,KAAK,CAACkF,IAAI,EAAE,CAAC;EAC3C,KAAK,MAAM7E,IAAI,IAAIM,IAAI,EAAE;IACvB,MAAMwE,KAAK,GAAG,IAAI,CAACnF,KAAK,CAACY,GAAG,CAACP,IAAI,CAAC,CAChC+E,GAAG,CAACC,CAAC,IAAIC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEF,CAAC,EAAE;MAAEhF,IAAI,EAAEA;IAAK,CAAC,CAAC,CAAC,CAC9C0E,MAAM,CAAClD,EAAE,CAAC;IAEZ,IAAIsD,KAAK,CAACzE,MAAM,KAAK,CAAC,EAAE;MACtBsE,KAAK,CAAChF,KAAK,CAACwF,MAAM,CAACnF,IAAI,CAAC;MACxB;IACF;IAEA8E,KAAK,CAACpE,QAAQ,GAAGoE,KAAK,CAACJ,MAAM,CAACM,CAAC,IAAIA,CAAC,CAAC7D,OAAO,CAAC,CAACd,MAAM;IAEpDsE,KAAK,CAAChF,KAAK,CAACyF,GAAG,CAACpF,IAAI,EAAE8E,KAAK,CAAC;EAC9B;EAEA,MAAMxC,KAAK,GAAGkC,KAAK,CAACI,IAAI,CAACD,KAAK,CAAC9E,MAAM,CAACgF,IAAI,EAAE,CAAC;EAC7C,KAAK,MAAM7E,IAAI,IAAIsC,KAAK,EAAE;IACxB,MAAMwC,KAAK,GAAG,IAAI,CAACjF,MAAM,CAACU,GAAG,CAACP,IAAI,CAAC,CACjC+E,GAAG,CAACC,CAAC,IAAIC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEF,CAAC,EAAE;MAAEhF,IAAI,EAAEA;IAAK,CAAC,CAAC,CAAC,CAC9C0E,MAAM,CAAClD,EAAE,CAAC;IAEZ,IAAIsD,KAAK,CAACzE,MAAM,KAAK,CAAC,EAAE;MACtBsE,KAAK,CAAC9E,MAAM,CAACsF,MAAM,CAACnF,IAAI,CAAC;MACzB;IACF;IAEA2E,KAAK,CAAC9E,MAAM,CAACuF,GAAG,CAACpF,IAAI,EAAE8E,KAAK,CAAC;EAC/B;EAEA,OAAOH,KAAK;AACd,CAAC;AAEDjF,MAAM,CAACI,SAAS,CAACuF,QAAQ,GAAG,UAASrF,IAAI,EAAE;EACzC,OAAO,IAAI,CAACL,KAAK,CAAC2F,GAAG,CAACtF,IAAI,CAAC,IAAI,IAAI,CAACH,MAAM,CAACyF,GAAG,CAACtF,IAAI,CAAC;AACtD,CAAC;AAEDN,MAAM,CAACI,SAAS,CAACyF,aAAa,GAAG,UAASvF,IAAI,EAAEwB,EAAE,EAAEvB,OAAO,EAAEoC,OAAO,EAAE;EACpE,IAAIyB,KAAK,GAAG,IAAI;EAChB,IAAI,CAAC,IAAI,CAACuB,QAAQ,CAACrF,IAAI,CAAC,EAAE;IACxB;IACA;IACA,OAAO,YAAW;MAChBe,OAAO,CAACC,QAAQ,CAAC,MAAMQ,EAAE,CAACU,KAAK,CAAC,IAAI,EAAE9B,SAAS,CAAC,CAAC;IACnD,CAAC;EACH;EACA,OAAO,YAAW;IAChB,IAAIoF,QAAQ,GAAGvF,OAAO,IAAI,IAAI;IAC9B,IAAIC,IAAI,GAAGsE,KAAK,CAAC1E,SAAS,CAAC+D,KAAK,CAAC/B,IAAI,CAAC1B,SAAS,CAAC;IAChD0D,KAAK,CAACJ,IAAI,CAAC1D,IAAI,EAAEwB,EAAE,EAAEgE,QAAQ,EAAEtF,IAAI,EAAEmC,OAAO,CAAC;EAC/C,CAAC;AACH,CAAC;AAED3C,MAAM,CAACI,SAAS,CAACoB,GAAG,GAAG,UAASlB,IAAI,EAAEmB,OAAO,EAAEK,EAAE,EAAEF,KAAK,EAAEmE,OAAO,EAAE;EACjE,IAAIpD,OAAO,GAAG,CAAC,CAAC;EAChB,IAAI,OAAOlB,OAAO,KAAK,QAAQ,IAAIA,OAAO,IAAI,IAAI,EAAE;IAClDkB,OAAO,GAAGlB,OAAO;IACjBA,OAAO,GAAGkB,OAAO,CAAClB,OAAO;EAC3B,CAAC,MAAM,IAAI,OAAOf,SAAS,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE;IAC5CkB,KAAK,GAAGE,EAAE;IACVA,EAAE,GAAGL,OAAO;IACZA,OAAO,GAAG,KAAK;EACjB;EAEA,MAAMb,IAAI,GAAGC,GAAG,CAAC,IAAI,CAACZ,KAAK,EAAEK,IAAI,EAAE,EAAE,CAAC;EACtC,IAAI,CAACL,KAAK,CAACyF,GAAG,CAACpF,IAAI,EAAEM,IAAI,CAAC;EAE1B,IAAIa,OAAO,EAAE;IACXb,IAAI,CAACI,QAAQ,GAAGJ,IAAI,CAACI,QAAQ,IAAI,CAAC;IAClC,EAAEJ,IAAI,CAACI,QAAQ;EACjB;EAEA,IAAI,OAAOc,EAAE,KAAK,UAAU,EAAE;IAC5B,MAAM,IAAIkE,KAAK,CAAC,kCAAkC,GAAG,OAAOlE,EAAE,GAAG,GAAG,CAAC;EACvE;EAEA,IAAIiE,OAAO,EAAE;IACXnF,IAAI,CAACmF,OAAO,CAACR,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAE7C,OAAO,EAAE;MAAEb,EAAE,EAAEA,EAAE;MAAEL,OAAO,EAAEA;IAAQ,CAAC,CAAC,CAAC;EACxE,CAAC,MAAM;IACLb,IAAI,CAACsB,IAAI,CAACqD,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAE7C,OAAO,EAAE;MAAEb,EAAE,EAAEA,EAAE;MAAEL,OAAO,EAAEA;IAAQ,CAAC,CAAC,CAAC;EACrE;EAEA,OAAO,IAAI;AACb,CAAC;AAEDzB,MAAM,CAACI,SAAS,CAAC4C,IAAI,GAAG,UAAS1C,IAAI,EAAEqC,OAAO,EAAEb,EAAE,EAAEiE,OAAO,EAAE;EAC3D,MAAMX,KAAK,GAAGvE,GAAG,CAAC,IAAI,CAACV,MAAM,EAAEG,IAAI,EAAE,EAAE,CAAC;EAExC,IAAI,OAAOqC,OAAO,KAAK,UAAU,EAAE;IACjCoD,OAAO,GAAG,CAAC,CAACjE,EAAE;IACdA,EAAE,GAAGa,OAAO;IACZA,OAAO,GAAG,CAAC,CAAC;EACd;EAEA,IAAI,OAAOb,EAAE,KAAK,UAAU,EAAE;IAC5B,MAAM,IAAIkE,KAAK,CAAC,mCAAmC,GAAG,OAAOlE,EAAE,GAAG,GAAG,CAAC;EACxE;EAEA,IAAIiE,OAAO,EAAE;IACXX,KAAK,CAACW,OAAO,CAACR,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAE7C,OAAO,EAAE;MAAEb,EAAE,EAAEA;IAAG,CAAC,CAAC,CAAC;EACvD,CAAC,MAAM;IACLsD,KAAK,CAAClD,IAAI,CAACqD,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAE7C,OAAO,EAAE;MAAEb,EAAE,EAAEA;IAAG,CAAC,CAAC,CAAC;EACpD;EACA,IAAI,CAAC3B,MAAM,CAACuF,GAAG,CAACpF,IAAI,EAAE8E,KAAK,CAAC;EAC5B,OAAO,IAAI;AACb,CAAC;AAEDpF,MAAM,CAACI,SAAS,CAAC6E,KAAK,GAAG,YAAW;EAClC,MAAMgB,CAAC,GAAG,IAAIjG,MAAM,EAAE;EAEtB,KAAK,IAAIkG,GAAG,IAAI,IAAI,CAACjG,KAAK,CAACkF,IAAI,EAAE,EAAE;IACjC,MAAMF,KAAK,GAAG,IAAI,CAAChF,KAAK,CAACY,GAAG,CAACqF,GAAG,CAAC,CAAC/B,KAAK,EAAE;IACzCc,KAAK,CAACjE,QAAQ,GAAG,IAAI,CAACf,KAAK,CAACY,GAAG,CAACqF,GAAG,CAAC,CAAClF,QAAQ;IAC7CiF,CAAC,CAAChG,KAAK,CAACyF,GAAG,CAACQ,GAAG,EAAEjB,KAAK,CAAC;EACzB;EACA,KAAK,IAAIiB,GAAG,IAAI,IAAI,CAAC/F,MAAM,CAACgF,IAAI,EAAE,EAAE;IAClCc,CAAC,CAAC9F,MAAM,CAACuF,GAAG,CAACQ,GAAG,EAAE,IAAI,CAAC/F,MAAM,CAACU,GAAG,CAACqF,GAAG,CAAC,CAAC/B,KAAK,EAAE,CAAC;EACjD;EAEA,OAAO8B,CAAC;AACV,CAAC;AAEDjG,MAAM,CAACI,SAAS,CAAC+F,KAAK,GAAG,UAASC,KAAK,EAAEnB,KAAK,EAAE;EAC9CA,KAAK,GAAGvE,SAAS,CAACC,MAAM,KAAK,CAAC,GAAG,IAAI,GAAGsE,KAAK;EAC7C,IAAIN,GAAG,GAAGM,KAAK,GAAG,IAAI,CAACA,KAAK,EAAE,GAAG,IAAI;EAErC,KAAK,IAAIiB,GAAG,IAAIE,KAAK,CAACnG,KAAK,CAACkF,IAAI,EAAE,EAAE;IAClC,MAAMkB,UAAU,GAAGxF,GAAG,CAAC8D,GAAG,CAAC1E,KAAK,EAAEiG,GAAG,EAAE,EAAE,CAAC;IAC1C,MAAMI,YAAY,GAAGF,KAAK,CAACnG,KAAK,CAACY,GAAG,CAACqF,GAAG,CAAC;IACvC;IACAlB,MAAM,CAACuB,CAAC,IAAIF,UAAU,CAAChB,GAAG,CAACmB,EAAE,IAAIA,EAAE,CAAC1E,EAAE,CAAC,CAAC2E,OAAO,CAACF,CAAC,CAACzE,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC;IAC/D,MAAM4E,QAAQ,GAAGL,UAAU,CAACrE,MAAM,CAACsE,YAAY,CAAC;IAChDI,QAAQ,CAAC1F,QAAQ,GAAGqF,UAAU,CAACrF,QAAQ,IAAI,CAAC;IAC5C0F,QAAQ,CAAC1F,QAAQ,IAAIsF,YAAY,CAACtB,MAAM,CAACuB,CAAC,IAAIA,CAAC,CAAC9E,OAAO,CAAC,CAACd,MAAM;IAC/DgE,GAAG,CAAC1E,KAAK,CAACyF,GAAG,CAACQ,GAAG,EAAEQ,QAAQ,CAAC;EAC9B;EACA,KAAK,IAAIR,GAAG,IAAIE,KAAK,CAACjG,MAAM,CAACgF,IAAI,EAAE,EAAE;IACnC,MAAMwB,WAAW,GAAG9F,GAAG,CAAC8D,GAAG,CAACxE,MAAM,EAAE+F,GAAG,EAAE,EAAE,CAAC;IAC5C,MAAMI,YAAY,GAAGF,KAAK,CAACjG,MAAM,CAACU,GAAG,CAACqF,GAAG,CAAC,CACxClB,MAAM,CAACuB,CAAC,IAAII,WAAW,CAACF,OAAO,CAACF,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;IAC5C5B,GAAG,CAACxE,MAAM,CAACuF,GAAG,CAACQ,GAAG,EAAES,WAAW,CAAC3E,MAAM,CAACsE,YAAY,CAAC,CAAC;EACvD;EAEA,OAAO3B,GAAG;AACZ,CAAC;AAED,SAAS9D,GAAG,CAACwE,GAAG,EAAEa,GAAG,EAAEU,GAAG,EAAE;EAC1B,IAAIvB,GAAG,CAACO,GAAG,CAACM,GAAG,CAAC,EAAE;IAChB,OAAOb,GAAG,CAACxE,GAAG,CAACqF,GAAG,CAAC;EACrB;EACA,OAAOU,GAAG;AACZ;AAEA,SAAS/E,sBAAsB,CAACC,EAAE,EAAEvB,OAAO,EAAEC,IAAI,EAAEe,IAAI,EAAE;EACvD,IAAIY,YAAY;EAChB,IAAI;IACFA,YAAY,GAAGL,EAAE,CAACU,KAAK,CAACjC,OAAO,EAAEC,IAAI,CAAC;EACxC,CAAC,CAAC,OAAOoB,KAAK,EAAE;IACd,OAAOL,IAAI,CAACK,KAAK,CAAC;EACpB;EAEA,IAAIU,SAAS,CAACH,YAAY,CAAC,EAAE;IAC3BA,YAAY,CAACI,IAAI,CAAC,MAAMhB,IAAI,EAAE,EAAEc,GAAG,IAAId,IAAI,CAACc,GAAG,CAAC,CAAC;EACnD;AACF;AAEA,SAASC,SAAS,CAACuE,CAAC,EAAE;EACpB,OAAOA,CAAC,IAAI,IAAI,IAAI,OAAOA,CAAC,CAACtE,IAAI,KAAK,UAAU;AAClD;AAEA,SAASb,cAAc,CAACI,EAAE,EAAE;EAC1B,IAAIgF,MAAM,GAAG,KAAK;EAClB,IAAI1C,KAAK,GAAG,IAAI;EAChB,OAAO,YAAW;IAChB;IACA,IAAI0C,MAAM,EAAE;MACV;IACF;IACAA,MAAM,GAAG,IAAI;IACb;IACA;IACA,OAAOzF,OAAO,CAACC,QAAQ,CAAC,MAAMQ,EAAE,CAACU,KAAK,CAAC4B,KAAK,EAAE1D,SAAS,CAAC,CAAC;EAC3D,CAAC;AACH;AAEAqG,MAAM,CAACC,OAAO,GAAGhH,MAAM"},"metadata":{},"sourceType":"script","externalDependencies":[]}